# 4. Client-side routing using history API and redirects

Date: 2020-11-16

## Status

Accepted

Amended by [5. Replace redirects with HTML pages](0005-replace-redirects-with-html-pages.md)

## Context

Given that this repo may accumulate several pixel art entries over time it would be handy to be able to link to a specific image. As this project will be hosted on Github Pages we cannot use wildcard routes or server-side rendering.

Furthermore, if these links are shared via Slack or other services we would like to customise the link preview. Slack supports the following formats for site metadata:

- [oEmbed](http://oembed.com/) - Requires an API endpoint that returns data about a given URL
- [Twitter cards](https://developer.twitter.com/en/docs/twitter-for-websites/cards/guides/getting-started) - Enhances preview for links shared in Twitter. Configured via `meta` tags
- [Open Graph Protocol](https://ogp.me/) - Allows us to configure link preview image, description and more. Also configured via `meta` tags

Source: [Slack Robots | Slack](https://api.slack.com/robots)

## Decision

We will use [React Router](https://reactrouter.com/web) to provide client-side routing. This application will only have one route which will indicate the selected image via an optional route parameter.

```js
<Route path="/:filename?">
```

To ensure that the links generated by React Router's `BrowserRouter` continue to work once the application is deployed to Github Pages we will also generate a HTML file for each pixel art entry on deploy. Each of these pages will

- Be named `:filename.html` to match up to the links generated by React Router's `Link`
- Redirect to `index.html` where the React application is mounted. The application will then pre-select the image specified by the filename

These generated HTML files will also include Open Graph Protocol `meta` tags so that they display a preview and a description for the selected image when unfurled in applications that support Open Graph Protocol tags such as Slack.

## Consequences

- There may be a mismatch in behaviour between what is seen in development and production as different pages will be served in each. (`index.html` in dev using Webpack Dev Server's history fallback vs. a generated HTML file in production)
